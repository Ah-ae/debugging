# 📂 스텝 2: 다중 파일 업로드 로직 디버깅 실습 가이드

# 🎯 학습 목표

다중 파일 업로드 로직의 버그를 발견하고 수정하는 과정을 경험합니다.

# 📝 실습 가이드

## 1. 실습 시나리오

### 🪲 버그 리포트

당신은 신입 백엔드 개발자입니다. 당신의 입사 동기인 신입 프론트엔드 개발자로부터 파일 업로드 API에 뭔가 문제가 있다는 메시지를 받았습니다. 얼마전 퇴사한 동료가 만들어둔 API로, 당신은 아직 코드도 못 읽어본 상태입니다.

당신 동기의 말에 따르면 A 유저의 파일들은 업로드가 다 되는데, B 유저의 파일들은 업로드시 일부가 성공했다고 메시지는 나오지만 실제로는 아무것도 업로드가 되지 않는다고 합니다.

동기가 A 유저의 파일들과 B 유저의 파일들을 전달해주었습니다. 퇴사한 동료가 만들어둔 버그를 대신 고쳐봅시다.

### API 목록

- `POST /upload` : "files" key에 여러 파일을 formData 로 전송해서 업로드하고, 업로드 성공한 파일 목록을 응답으로 반환한다.
- `GET /files` : 서버에 업로드된 파일 목록을 반환한다.

## 2. 디버깅 마인드셋 템플릿을 활용한 문제 해결

### Step 1: 문제 정의

현재 풀고자 하는 문제를 한 문장으로 명확하게 정의해보세요.

### Step 2: 올바른 동작 정의

파일 업로드 기능이 올바르게 동작한다면 어떤 일이 벌어져야 하는지 정의해보세요. 이를 명확하게 정의하기 위해 올바른 동작을 given, when, then 형식으로 기술해보세요.

### Step 3: 최소 재현 환경 구축하며 관찰

문제가 발생한 시점을 정확히 확인 후 내 환경에서 직접 재현하기 위해 문제가 있는 부분을 격리시켜보세요. 그리고 재현 환경과 정상 동작의 차이점을 관찰하고, 관찰한 내용을 적어보세요.

### Step 4: 차이를 발생시키는 다양한 원인 탐색

Step 3에서 관찰한 차이를 발생시키는 원인이 될 만한 옵션들을 자유롭게 적어보세요. 옵션을 적기 어렵다면 추가 정보를 수집해보세요.

### Step 5: 가설 설정 및 검증

Step 4에서 도출한 옵션 중 하나를 선택하여 검증 가능한 가설을 세워보세요. 그리고 코드에 작은 변경을 가하면서 가설대로 현상이 변하는지 관찰해보세요.

만약 가설이 틀렸다면 그 이유를 적어보고, 다른 가설로 넘어가 반복해보세요.

<details>
<summary>힌트</summary>

- 파일 업로드 시 발생하는 오류를 처리하고, 사용자에게 에러 메시지를 반환해야 합니다.
- 예를 들어, 파일 크기 제한을 초과한 파일이 있을 때 각 파일의 업로드 상태를 기록하고, 에러 메시지를 포함하여 사용자에게 반환할 수 있습니다.

간단한 에러 처리 예시:

```jsx
app.post("/upload", (req, res) => {
  upload(req, res, (err) => {
    if (err) {
      return res.status(400).json({ message: err.message });
    }

    const uploadedFiles = req.files.map((file) => ({
      fileName: file.originalname,
      filePath: file.path,
      fileSize: file.size,
    }));

    res.json({
      message: "Files uploaded successfully.",
      files: uploadedFiles,
    });
  });
});
```

console을 이용하여 `err.code`를 출력하여 어떤 에러가 발생했는지 확인하고 이를 처리하는 방법을 생각해보세요.

</details>
